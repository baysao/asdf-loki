#!/bin/bash

set -o nounset -o pipefail -o errexit

tmp_download_dir="$(mktemp -d -t 'asdf_loki_XXXXXX')"
trap 'rm -rf "${tmp_download_dir}"' EXIT

_install() {
	local install_type="$1"
	local version="$2"
	local install_path="$3"
	local tmp_download_dir="$4"
	cd $tmp_download_dir
	v=v$version
	f=loki-linux-amd64.zip
	if [ ! -f "$f" ]; then
		curl -Lo "$f" "https://github.com/grafana/loki/releases/download/v1.6.1/$f"
	fi
	if [ ! -d "$(basename $f .zip)" ]; then unzip $f; fi
	mv ./loki-linux-amd64 $install_path/loki
}
_install "$ASDF_INSTALL_TYPE" "$ASDF_INSTALL_VERSION" "$ASDF_INSTALL_PATH" "$tmp_download_dir"
